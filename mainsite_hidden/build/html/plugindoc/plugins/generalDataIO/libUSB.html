

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>3.9. LibUSB &mdash; itom Documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3.10. SerialIO" href="serialIO.html" />
    <link rel="prev" title="3.8. HidApi" href="hidApi.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> itom Plugins
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../grabbers.html">1. Camera/ Grabber</a></li>
<li class="toctree-l1"><a class="reference internal" href="../actuators.html">2. Motors/ Actuators</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../GDIO.html">3. General Data IO</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="CyUSB.html">3.1. CyUSB</a></li>
<li class="toctree-l2"><a class="reference internal" href="LibModBus.html">3.2. LibModBus</a></li>
<li class="toctree-l2"><a class="reference internal" href="SuperlumBL.html">3.3. SuperlumBL</a></li>
<li class="toctree-l2"><a class="reference internal" href="SuperlumBS.html">3.4. SuperlumBS</a></li>
<li class="toctree-l2"><a class="reference internal" href="dispWindow.html">3.5. DispWindow</a></li>
<li class="toctree-l2"><a class="reference internal" href="glDisplay.html">3.6. GLDisplay</a></li>
<li class="toctree-l2"><a class="reference internal" href="gwInstekPSP.html">3.7. GWInstekPSP</a></li>
<li class="toctree-l2"><a class="reference internal" href="hidApi.html">3.8. HidApi</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.9. LibUSB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">3.9.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initialization">3.9.2. Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameters">3.9.3. Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">3.9.4. Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compilation">3.9.5. Compilation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#possible-linker-problems-with-visual-studio">3.9.5.1. Possible linker problems with Visual Studio</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#changelog">3.9.6. Changelog</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="serialIO.html">3.10. SerialIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="thorlabsPowerMeter.html">3.11. Thorlabs Power Meter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../adconv.html">4. AD-Converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms.html">5. Algorithms/ Filters</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">itom Plugins</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../GDIO.html"><span class="section-number">3. </span>General Data IO</a> &raquo;</li>
        
      <li><span class="section-number">3.9. </span>LibUSB</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/plugins/generalDataIO/libUSB.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="libusb">
<h1><span class="section-number">3.9. </span>LibUSB<a class="headerlink" href="#libusb" title="Permalink to this headline">¶</a></h1>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 87%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Summary</strong>:</p></td>
<td><p><span>itom-plugin for a usb port communication</span></p></td>
</tr>
<tr class="row-even"><td><p><strong>Type</strong>:</p></td>
<td><p><span>DataIO</span></p></td>
</tr>
<tr class="row-odd"><td><p><strong>License</strong>:</p></td>
<td><p><span>licensed under LGPL</span></p></td>
</tr>
<tr class="row-even"><td><p><strong>Platforms</strong>:</p></td>
<td><p>Windows (Vista, 7, 8)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Devices</strong>:</p></td>
<td><p>Any generic USB devices</p></td>
</tr>
<tr class="row-even"><td><p><strong>Author</strong>:</p></td>
<td><p><span>W. Lyda, twip optical solutions GmbH Stuttgart</span></p></td>
</tr>
</tbody>
</table>
<div class="section" id="overview">
<h2><span class="section-number">3.9.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>LibUSB is a itom-Plugin which gives direct/raw access to a device connected to the serial port.
It can be used by plugins for communication analog to the serial port.
The plugin is implemented for Windows, but Linux should be possible due to libUSB is also availble on Linux.</p>
<p>To connect to a device you need the vendor id and the product id.</p>
<p>The setVal and getVal functions will write and read on the specified endpoint.</p>
</div>
<div class="section" id="initialization">
<h2><span class="section-number">3.9.2. </span>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h2>
<p>The following parameters are mandatory or optional for initializing an instance of this plugin:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><strong>VendorID</strong>: {int} [0,65535], default: 7358, step: 1</dt><dd><p>The vendor id of the device to connect to</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ProductID</strong>: {int} [0,65535], default: 3, step: 1</dt><dd><p>The product id of the device to connect to</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>endpoint</strong>: {int} [0,127], default: 1, step: 1</dt><dd><p>The endpoint to communicate with.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>timeout</strong>: {float, optional} [0.0,65.0], default: 4.0</dt><dd><p>Timeout for reading commands in [s]</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>debugLevel</strong>: {int, optional} [0,5], default: 0, step: 1</dt><dd><p>Debug level: 0 (LIBUSB_LOG_LEVEL_NONE): no messages ever printed by the library. 1 (ERROR): error messages are printed to stderr, 2 (WARNING): warning and error messages are printed to stderr, 3 (INFO): informational messages are printed to stdout, warning and error messages are printed to stderr, 4 (DEBUG): like 3 but debug messages are also printed to stdout.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>printInfoAboutAllDevices</strong>: {int, optional} [0,1], default: 0, step: 1</dt><dd><p>If true, all information about connected devices is print to the console.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="parameters">
<h2><span class="section-number">3.9.3. </span>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<p>An instance of this plugin has the following internal parameters:</p>
<dl class="simple">
<dt><strong>debug</strong>: {int}</dt><dd><p>If true, all out and inputs are written to dockingWidget</p>
</dd>
<dt><strong>endpoint_read</strong>: {int}</dt><dd><p>Endpoint index for reading operations. The used index is LIBUSB_ENDPOINT_IN + endpoint_read, with LIBUSB_ENDPOINT_IN = 128 (default: initialization parameter ‘endpoint’)</p>
</dd>
<dt><strong>endpoint_write</strong>: {int}</dt><dd><p>Endpoint index for writing operations. The used index is LIBUSB_ENDPOINT_OUT + endpoint_write, with LIBUSB_ENDPOINT_OUT = 0  (default: initialization parameter ‘endpoint’)</p>
</dd>
<dt><strong>name</strong>: {str}</dt><dd><p>name of the device</p>
</dd>
<dt><strong>timeout</strong>: {float}</dt><dd><p>Timeout for reading commands in [s]</p>
</dd>
</dl>
</div>
<div class="section" id="usage">
<h2><span class="section-number">3.9.4. </span>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Any USB device is defined by its vendor and product ID. Both are usually hex-values. If the connection is established via the GUI dialog, the corresponding integer
values need to be given. If you have no idea about the vendor and product ID, set the optional initialization parameter <em>printInfoAboutAllDevices</em> to 1 (True). Then,
information about all connected USB devices including its name and vendor / product ID is printed to the console.</p>
<p>Once the device is identified, you need to indicate a so called endpoint ID. The read- and write-communication with the device is done via several endpoints. All reading endpoints
are in the range 128..255 while the writing endpoints are between 0..127. For many devices the corresponding read/write endpoints have the same offset between its limit 0 and 128.
Therefore, the initialization only contains the parameter ‘endpoint’, such that <em>endpoint_read</em> is set to 128+endpoint and <em>endpoint_write</em> to ‘endpoint’. You can always change
the endpoints using the specific parameters.</p>
<p>Again, if you set <em>printInfoAboutAllDevices</em> to 1 at initialization, the available endpoints are also print to the console for the selected device. If the list can not resolve further
information for your selected device, this device can not be used by this generic plugin. This can also be the case for devices that support the VISA-standard. If you want to use
such devices consider to use the Python package <em>PyVISA</em>.</p>
<p>Once the USB-device is opened and the endpoints are configured, you can send and read data in the same way than via a serial connection (see help for plugin <strong>SerialIO</strong>).:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#send values:</span>
<span class="n">usbDevice</span><span class="o">.</span><span class="n">setVal</span><span class="p">(</span><span class="s2">&quot;myCommand&quot;</span><span class="p">)</span>

<span class="c1">#read values:</span>
<span class="n">b</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">#buffer</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">usbDevice</span><span class="o">.</span><span class="n">getVal</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="c1">#number of characters read</span>
</pre></div>
</div>
<p>The command <strong>getVal</strong> only reads the number of characters that arrived at the current endpoint at the moment of its call. Analyze the return value and probably call <strong>getVal</strong>
again if you expect more characters to arrive. This is also the same behaviour than for serial connections.</p>
<p>This plugin is also used by other hardware plugins to communicate with further devices.</p>
</div>
<div class="section" id="compilation">
<h2><span class="section-number">3.9.5. </span>Compilation<a class="headerlink" href="#compilation" title="Permalink to this headline">¶</a></h2>
<p>In order to compile LibUSB, get the sources or binaries from LibUSB from <a class="reference external" href="http://www.libusb.info">http://www.libusb.info</a>. Then set LibUSB_DIR to the base
directory of the 3rd party libusb. libusb is statically linked to the libUSB plugin.</p>
<p>Hint: prebuilt versions of libusb for Visual Studio 2015 can also be found here: <a class="reference external" href="https://sourceforge.net/projects/itom/files/all-in-one-build-setup/Optional-3rdParty">https://sourceforge.net/projects/itom/files/all-in-one-build-setup/Optional-3rdParty</a></p>
<div class="section" id="possible-linker-problems-with-visual-studio">
<h3><span class="section-number">3.9.5.1. </span>Possible linker problems with Visual Studio<a class="headerlink" href="#possible-linker-problems-with-visual-studio" title="Permalink to this headline">¶</a></h3>
<p>If you get a linker error (similar to <strong>unresolved symbol __imp__vsnprintf</strong>, <strong>unresolved symbol **__imp__iob</strong> in libusb-1.0.lib),
then it is likely that the compiled binaries of libusb are not compatible with your version of Visual Studio.</p>
<p>In this case you have to compile LibUSB by yourself using your version of Visual Studio:</p>
<ol class="arabic">
<li><p>Download and unpack the sources of <strong>libusb</strong> (<a class="reference external" href="https://github.com/libusb/libusb/releases">https://github.com/libusb/libusb/releases</a>) to any folder</p></li>
<li><p>Open the project <strong>msvc/libusb_static_XXXX.vcxproj</strong> with your Visual Studio, where XXXX corresponds to the correct version number.</p></li>
<li><p>Compile the project (libusb-1.0 static) as <strong>Release</strong> in x86 and / or x64.</p></li>
<li><p>Create a new folder (e.g. libusb_1.0.23_MSVC2015) and copy the following files to that folder ({sources} is the unpacked source folder):</p>
<blockquote>
<div><p>libusb_1.0.23_MSVC2015</p>
<blockquote>
<div><p>/include/libusb-1.0 –&gt; this must contain the header file <strong>libusb.h</strong> from {sources}/libusb
/MS32/static –&gt; this must contain the <strong>libusb-1.0.lib</strong> from {sources}/Win32/static (if 32bit build)
/MS64/static –&gt; this must contain the newly built <strong>libusb-1.0.lib</strong> from {sources}/Win64/static (if 64bit build)</p>
</div></blockquote>
</div></blockquote>
</li>
<li><p>Set the CMake variable LibUSB_DIR to this new folder.</p></li>
</ol>
</div>
</div>
<div class="section" id="changelog">
<h2><span class="section-number">3.9.6. </span>Changelog<a class="headerlink" href="#changelog" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>itom setup 2.1.0: This plugin has been compiled using the libusb 1.0.20</p></li>
<li><p>itom setup 2.2.0: This plugin has been compiled using the libusb 1.0.20</p></li>
<li><p>itom setup 3.0.0: This plugin has been compiled using the libusb 1.0.20</p></li>
<li><p>itom setup 3.1.0: This plugin has been compiled using the libusb 1.0.21</p></li>
<li><p>itom setup 3.2.1: This plugin has been compiled using the libusb 1.0.22</p></li>
<li><p>itom setup 4.0.0: This plugin has been compiled using the libusb 1.0.23</p></li>
<li><p>itom setup 4.1.0: This plugin has been compiled using the libusb 1.0.24</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="serialIO.html" class="btn btn-neutral float-right" title="3.10. SerialIO" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="hidApi.html" class="btn btn-neutral float-left" title="3.8. HidApi" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2011-2021, Institut fuer Technische Optik (ITO), University Stuttgart. Bug report: https://bitbucket.org/itom/itom/issues.
      <span class="lastupdated">
        Last updated on Mar 09, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>